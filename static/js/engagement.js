// Psychological Engagement & Growth Hacking JavaScript

// Global variables
let userProgress = {
    workoutsCompleted: parseInt(localStorage.getItem('workoutsCompleted') || '0'),
    caloriesTracked: parseInt(localStorage.getItem('caloriesTracked') || '0'),
    tipsTried: parseInt(localStorage.getItem('tipsTried') || '0'),
    currentStreak: parseInt(localStorage.getItem('currentStreak') || '0'),
    lastWorkoutDate: localStorage.getItem('lastWorkoutDate') || null,
    totalPoints: parseInt(localStorage.getItem('totalPoints') || '0')
};

let currentChallenge = JSON.parse(localStorage.getItem('currentChallenge') || 'null');
let didYouKnowFacts = [];
let currentFactIndex = 0;

// Initialize engagement features
document.addEventListener('DOMContentLoaded', function() {
    initializeProgressTracker();
    initializeWeeklyChallenge();
    initializeDidYouKnow();
    initializePushNotifications();
    initializeEmailCapture();
    initializeStatsCounter();
    updateProgressDisplay();
    checkDailyWorkout();
    
    // Update progress tracker on scroll
    window.addEventListener('scroll', updateScrollProgress);
    
    // Initialize contextual linking
    initializeContextualLinks();
});

// Progress Tracker Functions
function initializeProgressTracker() {
    // Create progress tracker if it doesn't exist
    if (!document.querySelector('.progress-tracker')) {
        const progressTracker = document.createElement('div');
        progressTracker.className = 'progress-tracker';
        progressTracker.innerHTML = '<div class="progress-tracker-fill"></div>';
        document.body.prepend(progressTracker);
    }
}

function updateScrollProgress() {
    const scrolled = (window.scrollY / (document.documentElement.scrollHeight - window.innerHeight)) * 100;
    const progressFill = document.querySelector('.progress-tracker-fill');
    if (progressFill) {
        progressFill.style.width = Math.min(scrolled, 100) + '%';
    }
}

function updateUserProgress(type, value = 1) {
    userProgress[type] += value;
    userProgress.totalPoints += value * 10; // 10 points per action
    
    // Save to localStorage
    Object.keys(userProgress).forEach(key => {
        localStorage.setItem(key, userProgress[key].toString());
    });
    
    updateProgressDisplay();
    checkAchievements();
}

function updateProgressDisplay() {
    // Update achievement card if exists
    const achievementCard = document.querySelector('.achievement-card');
    if (achievementCard) {
        const progressText = achievementCard.querySelector('.achievement-text');
        const progressFill = achievementCard.querySelector('.achievement-progress-fill');
        
        if (progressText && progressFill) {
            const totalActions = userProgress.workoutsCompleted + userProgress.caloriesTracked + userProgress.tipsTried;
            const progressPercentage = Math.min((totalActions / 50) * 100, 100); // Goal: 50 total actions
            
            progressText.textContent = `ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ${progressPercentage.toFixed(0)}% ŸÖŸÜ ÿÆÿ∑ÿ™ŸÉ - ÿßÿ≥ÿ™ŸÖÿ±!`;
            progressFill.style.width = progressPercentage + '%';
        }
    }
    
    // Update stats counter
    updateStatsDisplay();
}

// Weekly Challenge Functions
function initializeWeeklyChallenge() {
    if (!currentChallenge || isChallengePeriodOver()) {
        generateNewChallenge();
    }
    displayCurrentChallenge();
}

function generateNewChallenge() {
    const challenges = [
        {
            title: "ÿ™ÿ≠ÿØŸä ÿßŸÑŸÄ 7 ÿ£ŸäÿßŸÖ",
            description: "ÿ£ŸÉŸÖŸÑ 7 ÿ™ŸÖÿßÿ±ŸäŸÜ ŸÖÿ™ÿ™ÿßŸÑŸäÿ© Ÿàÿßÿ≠ÿµŸÑ ÿπŸÑŸâ ÿÆÿ∑ÿ© PDF ŸÖÿ¨ÿßŸÜŸäÿ©",
            target: 7,
            current: 0,
            type: "workout_streak",
            reward: "ÿÆÿ∑ÿ© ÿ™ŸÖÿßÿ±ŸäŸÜ PDF ŸÖÿÆÿµÿµÿ©",
            endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
            title: "ÿ™ÿ≠ÿØŸä ÿ≠ÿ±ŸÇ ÿßŸÑÿ≥ÿπÿ±ÿßÿ™",
            description: "ÿßÿ≠ÿ±ŸÇ 2000 ÿ≥ÿπÿ±ÿ© ÿ≠ÿ±ÿßÿ±Ÿäÿ© Ÿáÿ∞ÿß ÿßŸÑÿ£ÿ≥ÿ®Ÿàÿπ",
            target: 2000,
            current: 0,
            type: "calories_burned",
            reward: "ÿØŸÑŸäŸÑ ÿßŸÑÿ™ÿ∫ÿ∞Ÿäÿ© ÿßŸÑŸÖÿ™ŸÇÿØŸÖ",
            endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
        },
        {
            title: "ÿ™ÿ≠ÿØŸä ÿßŸÑŸÖÿπÿ±ŸÅÿ©",
            description: "ÿßŸÇÿ±ÿ£ 10 ŸÜÿµÿßÿ¶ÿ≠ ÿµÿ≠Ÿäÿ© Ÿàÿßÿ∑ÿ®ŸÇ 5 ŸÖŸÜŸáÿß",
            target: 10,
            current: 0,
            type: "tips_read",
            reward: "ÿßÿ≥ÿ™ÿ¥ÿßÿ±ÿ© ÿ™ÿ∫ÿ∞Ÿäÿ© ŸÖÿ¨ÿßŸÜŸäÿ©",
            endDate: new Date(Date.now() + 7 * 24 * 60 * 60 * 1000).toISOString()
        }
    ];
    
    currentChallenge = challenges[Math.floor(Math.random() * challenges.length)];
    localStorage.setItem('currentChallenge', JSON.stringify(currentChallenge));
}

function isChallengePeriodOver() {
    if (!currentChallenge || !currentChallenge.endDate) return true;
    return new Date() > new Date(currentChallenge.endDate);
}

function displayCurrentChallenge() {
    const challengeContainer = document.querySelector('.challenge-card');
    if (challengeContainer && currentChallenge) {
        const timeLeft = getTimeLeft(currentChallenge.endDate);
        const progressPercentage = (currentChallenge.current / currentChallenge.target) * 100;
        
        challengeContainer.innerHTML = `
            <h4><i class="fas fa-trophy me-2"></i>${currentChallenge.title}</h4>
            <p>${currentChallenge.description}</p>
            <div class="challenge-progress">
                <div class="achievement-progress">
                    <div class="achievement-progress-fill" style="width: ${progressPercentage}%"></div>
                </div>
                <small>${currentChallenge.current}/${currentChallenge.target}</small>
            </div>
            <div class="challenge-timer">
                <i class="fas fa-clock me-2"></i>ŸÖÿ™ÿ®ŸÇŸä: ${timeLeft}
            </div>
            <div class="mt-3">
                <strong>ÿßŸÑŸÖŸÉÿßŸÅÿ£ÿ©:</strong> ${currentChallenge.reward}
            </div>
        `;
    }
}

function getTimeLeft(endDate) {
    const now = new Date();
    const end = new Date(endDate);
    const diff = end - now;
    
    if (diff <= 0) return "ÿßŸÜÿ™ŸáŸâ ÿßŸÑŸàŸÇÿ™";
    
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    
    if (days > 0) return `${days} ŸäŸàŸÖ Ÿà ${hours} ÿ≥ÿßÿπÿ©`;
    return `${hours} ÿ≥ÿßÿπÿ©`;
}

function updateChallengeProgress(type, value = 1) {
    if (currentChallenge && currentChallenge.type === type) {
        currentChallenge.current = Math.min(currentChallenge.current + value, currentChallenge.target);
        localStorage.setItem('currentChallenge', JSON.stringify(currentChallenge));
        displayCurrentChallenge();
        
        if (currentChallenge.current >= currentChallenge.target) {
            showChallengeCompleted();
        }
    }
}

function showChallengeCompleted() {
    showNotification('üéâ ÿ™ŸáÿßŸÜŸäŸÜÿß! ŸÑŸÇÿØ ÿ£ŸÉŸÖŸÑÿ™ ÿßŸÑÿ™ÿ≠ÿØŸä ÿßŸÑÿ£ÿ≥ÿ®ŸàÿπŸä!', 'success');
    // Here you could trigger reward delivery
}

// Did You Know Functions
function initializeDidYouKnow() {
    didYouKnowFacts = [
        {
            icon: "üí™",
            fact: "ŸáŸÑ ÿ™ÿπŸÑŸÖ ÿ£ŸÜ ÿßŸÑÿπÿ∂ŸÑÿßÿ™ ÿ™ÿ≠ÿ±ŸÇ ÿ≥ÿπÿ±ÿßÿ™ ÿ≠ÿ±ÿßÿ±Ÿäÿ© ÿ≠ÿ™Ÿâ ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑÿ±ÿßÿ≠ÿ©ÿü ŸÉŸÑ ŸÉŸäŸÑŸà ÿπÿ∂ŸÑÿßÿ™ Ÿäÿ≠ÿ±ŸÇ 13 ÿ≥ÿπÿ±ÿ© ŸäŸàŸÖŸäÿßŸã!",
            link: "/calculators",
            linkText: "ÿßÿ≠ÿ≥ÿ® ŸÖÿπÿØŸÑ ÿßŸÑÿ≠ÿ±ŸÇ"
        },
        {
            icon: "ü•§",
            fact: "ÿ¥ÿ±ÿ® ÿßŸÑŸÖÿßÿ° ÿßŸÑÿ®ÿßÿ±ÿØ Ÿäÿ≠ÿ±ŸÇ ÿ≥ÿπÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ©! ÿ¨ÿ≥ŸÖŸÉ Ÿäÿ≠ÿ™ÿßÿ¨ ÿ∑ÿßŸÇÿ© ŸÑÿ™ÿØŸÅÿ¶ÿ© ÿßŸÑŸÖÿßÿ° ŸÑÿØÿ±ÿ¨ÿ© ÿ≠ÿ±ÿßÿ±ÿ© ÿßŸÑÿ¨ÿ≥ŸÖ.",
            link: "/meal-generator",
            linkText: "ÿÆÿ∑ÿ∑ Ÿàÿ¨ÿ®ÿßÿ™ŸÉ"
        },
        {
            icon: "üò¥",
            fact: "ÿßŸÑŸÜŸàŸÖ ÿ£ŸÇŸÑ ŸÖŸÜ 7 ÿ≥ÿßÿπÿßÿ™ Ÿäÿ≤ŸäÿØ Ÿáÿ±ŸÖŸàŸÜ ÿßŸÑÿ¨Ÿàÿπ ŸàŸäŸÇŸÑŸÑ Ÿáÿ±ŸÖŸàŸÜ ÿßŸÑÿ¥ÿ®ÿπÿå ŸÖŸÖÿß Ÿäÿµÿπÿ® ŸÅŸÇÿØÿßŸÜ ÿßŸÑŸàÿ≤ŸÜ.",
            link: "/tips",
            linkText: "ŸÜÿµÿßÿ¶ÿ≠ ÿßŸÑŸÜŸàŸÖ"
        },
        {
            icon: "üèÉ‚Äç‚ôÇÔ∏è",
            fact: "ÿßŸÑŸÖÿ¥Ÿä ŸÑŸÖÿØÿ© 30 ÿØŸÇŸäŸÇÿ© ŸäŸàŸÖŸäÿßŸã ŸäŸÇŸÑŸÑ ÿÆÿ∑ÿ± ÿ£ŸÖÿ±ÿßÿ∂ ÿßŸÑŸÇŸÑÿ® ÿ®ŸÜÿ≥ÿ®ÿ© 35%!",
            link: "/workout-plans",
            linkText: "ÿÆÿ∑ÿ∑ ÿßŸÑÿ™ŸÖÿßÿ±ŸäŸÜ"
        },
        {
            icon: "ü•ó",
            fact: "ÿßŸÑÿ£ŸÑŸäÿßŸÅ ÿ™ÿ¨ÿπŸÑŸÉ ÿ™ÿ¥ÿπÿ± ÿ®ÿßŸÑÿ¥ÿ®ÿπ ŸÑŸÅÿ™ÿ±ÿ© ÿ£ÿ∑ŸàŸÑ Ÿàÿ™ÿ≠ÿ±ŸÇ 10% ÿ≥ÿπÿ±ÿßÿ™ ÿ•ÿ∂ÿßŸÅŸäÿ© ÿ£ÿ´ŸÜÿßÿ° ÿßŸÑŸáÿ∂ŸÖ.",
            link: "/food-calories-guide",
            linkText: "ÿØŸÑŸäŸÑ ÿßŸÑÿ≥ÿπÿ±ÿßÿ™"
        }
    ];
    
    displayDidYouKnow();
    
    // Change fact every 30 seconds
    setInterval(rotateDidYouKnow, 30000);
}

function displayDidYouKnow() {
    const container = document.querySelector('.did-you-know');
    if (container && didYouKnowFacts.length > 0) {
        const fact = didYouKnowFacts[currentFactIndex];
        container.innerHTML = `
            <div class="did-you-know-icon">${fact.icon}</div>
            <h5>ŸáŸÑ ÿ™ÿπŸÑŸÖÿü</h5>
            <p>${fact.fact}</p>
            <a href="${fact.link}" class="btn btn-outline-primary btn-sm">
                ${fact.linkText} <i class="fas fa-arrow-left ms-2"></i>
            </a>
        `;
        
        container.addEventListener('click', () => {
            updateUserProgress('tipsTried');
            updateChallengeProgress('tips_read');
        });
    }
}

function rotateDidYouKnow() {
    currentFactIndex = (currentFactIndex + 1) % didYouKnowFacts.length;
    displayDidYouKnow();
}

// Push Notifications
function initializePushNotifications() {
    if ('Notification' in window && 'serviceWorker' in navigator) {
        requestNotificationPermission();
        scheduleNotifications();
    }
}

function requestNotificationPermission() {
    if (Notification.permission === 'default') {
        Notification.requestPermission().then(permission => {
            if (permission === 'granted') {
                showNotification('üéâ ÿ±ÿßÿ¶ÿπ! ÿ≥ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿ™ÿ∞ŸÉŸäÿ±ÿßÿ™ ŸäŸàŸÖŸäÿ© ŸÑŸÖÿ≥ÿßÿπÿØÿ™ŸÉ ŸÅŸä ÿ±ÿ≠ŸÑÿ™ŸÉ ÿßŸÑÿµÿ≠Ÿäÿ©', 'success');
            }
        });
    }
}

function scheduleNotifications() {
    // Schedule daily workout reminder
    const now = new Date();
    const tomorrow = new Date(now);
    tomorrow.setDate(tomorrow.getDate() + 1);
    tomorrow.setHours(9, 0, 0, 0); // 9 AM
    
    const timeUntilTomorrow = tomorrow.getTime() - now.getTime();
    
    setTimeout(() => {
        sendNotification('üí™ ŸàŸÇÿ™ ÿßŸÑÿ™ŸÖÿ±ŸäŸÜ!', 'ÿßÿ®ÿØÿ£ ŸäŸàŸÖŸÉ ÿ®ÿ™ŸÖÿ±ŸäŸÜ ŸÇÿµŸäÿ± ŸÑŸÖÿØÿ© 10 ÿØŸÇÿßÿ¶ŸÇ');
        // Schedule for next day
        setInterval(() => {
            sendNotification('üí™ ŸàŸÇÿ™ ÿßŸÑÿ™ŸÖÿ±ŸäŸÜ!', 'ÿßÿ®ÿØÿ£ ŸäŸàŸÖŸÉ ÿ®ÿ™ŸÖÿ±ŸäŸÜ ŸÇÿµŸäÿ± ŸÑŸÖÿØÿ© 10 ÿØŸÇÿßÿ¶ŸÇ');
        }, 24 * 60 * 60 * 1000);
    }, timeUntilTomorrow);
}

function sendNotification(title, body) {
    if (Notification.permission === 'granted') {
        new Notification(title, {
            body: body,
            icon: '/static/images/logo.png',
            badge: '/static/images/badge.png'
        });
    }
}

// Email Capture
function initializeEmailCapture() {
    const emailForm = document.querySelector('.email-form');
    if (emailForm) {
        emailForm.addEventListener('submit', handleEmailSubmit);
    }
}

function handleEmailSubmit(e) {
    e.preventDefault();
    const emailInput = e.target.querySelector('.email-input');
    const email = emailInput.value.trim();
    
    if (email && isValidEmail(email)) {
        // Save email to localStorage (in real app, send to server)
        localStorage.setItem('userEmail', email);
        
        showNotification('üéâ ÿ¥ŸÉÿ±ÿßŸã! ÿ≥ÿ™ÿ≠ÿµŸÑ ÿπŸÑŸâ ÿÆÿ∑ÿ© ŸÖÿ¨ÿßŸÜŸäÿ© ŸàŸÜÿµÿßÿ¶ÿ≠ ÿ£ÿ≥ÿ®ŸàÿπŸäÿ©', 'success');
        
        // Hide email capture form
        const emailCapture = document.querySelector('.email-capture');
        if (emailCapture) {
            emailCapture.style.display = 'none';
        }
        
        // Award points
        updateUserProgress('totalPoints', 50);
    } else {
        showNotification('‚ö†Ô∏è ÿßŸÑÿ±ÿ¨ÿßÿ° ÿ•ÿØÿÆÿßŸÑ ÿ®ÿ±ŸäÿØ ÿ•ŸÑŸÉÿ™ÿ±ŸàŸÜŸä ÿµÿ≠Ÿäÿ≠', 'warning');
    }
}

function isValidEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}

// Stats Counter
function initializeStatsCounter() {
    updateStatsDisplay();
    animateCounters();
}

function updateStatsDisplay() {
    const statsContainer = document.querySelector('.stats-counter');
    if (statsContainer) {
        statsContainer.innerHTML = `
            <h4 class="mb-4">ÿ•ŸÜÿ¨ÿßÿ≤ÿßÿ™ŸÉ</h4>
            <div class="row">
                <div class="col-4">
                    <div class="stat-item">
                        <span class="stat-number" data-target="${userProgress.workoutsCompleted}">0</span>
                        <div class="stat-label">ÿ™ŸÖÿ±ŸäŸÜ ŸÖŸÉÿ™ŸÖŸÑ</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="stat-item">
                        <span class="stat-number" data-target="${userProgress.caloriesTracked}">0</span>
                        <div class="stat-label">ÿ≥ÿπÿ±ÿ© ŸÖÿ™ÿ™ÿ®ÿπÿ©</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="stat-item">
                        <span class="stat-number" data-target="${userProgress.tipsTried}">0</span>
                        <div class="stat-label">ŸÜÿµŸäÿ≠ÿ© ŸÖÿ∑ÿ®ŸÇÿ©</div>
                    </div>
                </div>
            </div>
            <div class="mt-4">
                <h5>ÿßŸÑŸÜŸÇÿßÿ∑ ÿßŸÑÿ•ÿ¨ŸÖÿßŸÑŸäÿ©: <span class="text-warning">${userProgress.totalPoints}</span></h5>
            </div>
        `;
        
        animateCounters();
    }
}

function animateCounters() {
    const counters = document.querySelectorAll('.stat-number');
    counters.forEach(counter => {
        const target = parseInt(counter.getAttribute('data-target'));
        const increment = target / 50;
        let current = 0;
        
        const updateCounter = () => {
            if (current < target) {
                current += increment;
                counter.textContent = Math.floor(current);
                requestAnimationFrame(updateCounter);
            } else {
                counter.textContent = target;
            }
        };
        
        updateCounter();
    });
}

// Contextual Links
function initializeContextualLinks() {
    const contextualLinks = [
        {
            trigger: "ÿ™ÿÆÿ≥Ÿäÿ≥",
            title: "ÿ™ÿ±ŸäÿØ ÿ≠ÿ±ŸÇ ÿßŸÑÿØŸáŸàŸÜÿü",
            description: "ÿ¥ÿßŸáÿØ ÿ™ŸÖÿßÿ±ŸäŸÜ ÿßŸÑŸÉÿßÿ±ÿØŸäŸà ÿßŸÑŸÖÿ™ÿÆÿµÿµÿ©",
            link: "/workout-plans",
            icon: "üî•"
        },
        {
            trigger: "ÿπÿ∂ŸÑÿßÿ™",
            title: "ÿ™ÿ±ŸäÿØ ÿ®ŸÜÿßÿ° ÿßŸÑÿπÿ∂ŸÑÿßÿ™ÿü",
            description: "ÿßŸÉÿ™ÿ¥ŸÅ ÿßŸÑÿ£ÿ∑ÿπŸÖÿ© ÿπÿßŸÑŸäÿ© ÿßŸÑÿ®ÿ±Ÿàÿ™ŸäŸÜ",
            link: "/food-calories-guide",
            icon: "üí™"
        },
        {
            trigger: "ÿ≥ÿπÿ±ÿßÿ™",
            title: "ÿ™ÿ±ŸäÿØ ÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ÿü",
            description: "ÿßÿ≥ÿ™ÿÆÿØŸÖ ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ÿßŸÑŸÖÿ™ŸÇÿØŸÖÿ©",
            link: "/calculators",
            icon: "üßÆ"
        }
    ];
    
    // Add contextual links based on page content
    const pageContent = document.body.textContent.toLowerCase();
    contextualLinks.forEach(link => {
        if (pageContent.includes(link.trigger)) {
            addContextualLink(link);
        }
    });
}

function addContextualLink(linkData) {
    const container = document.querySelector('.container');
    if (container) {
        const contextualDiv = document.createElement('div');
        contextualDiv.className = 'contextual-link';
        contextualDiv.innerHTML = `
            <div class="d-flex align-items-center">
                <div class="me-3" style="font-size: 2rem;">${linkData.icon}</div>
                <div>
                    <h6 class="mb-1">${linkData.title}</h6>
                    <p class="mb-0">${linkData.description}</p>
                </div>
                <div class="ms-auto">
                    <a href="${linkData.link}" class="btn btn-outline-primary btn-sm">
                        ÿßŸÉÿ™ÿ¥ŸÅ <i class="fas fa-arrow-left ms-1"></i>
                    </a>
                </div>
            </div>
        `;
        
        container.appendChild(contextualDiv);
    }
}

// Daily Workout Video
function checkDailyWorkout() {
    const today = new Date().toDateString();
    const lastVideoDate = localStorage.getItem('lastVideoDate');
    
    if (lastVideoDate !== today) {
        loadDailyWorkoutVideo();
        localStorage.setItem('lastVideoDate', today);
    }
}

function loadDailyWorkoutVideo() {
    const workoutVideos = [
        {
            title: "ÿ™ŸÖÿ±ŸäŸÜ ÿßŸÑÿµÿ®ÿßÿ≠ - 10 ÿØŸÇÿßÿ¶ŸÇ",
            description: "ÿßÿ®ÿØÿ£ ŸäŸàŸÖŸÉ ÿ®ÿ∑ÿßŸÇÿ© ÿ•Ÿäÿ¨ÿßÿ®Ÿäÿ©",
            thumbnail: "/static/images/workout1.jpg",
            duration: "10:00"
        },
        {
            title: "ÿ™ŸÖÿ±ŸäŸÜ ÿßŸÑÿ®ÿ∑ŸÜ ÿßŸÑÿ≥ÿ±Ÿäÿπ",
            description: "5 ÿØŸÇÿßÿ¶ŸÇ ŸÑÿπÿ∂ŸÑÿßÿ™ ÿ®ÿ∑ŸÜ ŸÇŸàŸäÿ©",
            thumbnail: "/static/images/workout2.jpg",
            duration: "05:00"
        },
        {
            title: "ÿ™ŸÖÿ±ŸäŸÜ ÿßŸÑŸÉÿßÿ±ÿØŸäŸà ÿßŸÑŸÖŸÜÿ≤ŸÑŸä",
            description: "ÿßÿ≠ÿ±ŸÇ ÿßŸÑÿ≥ÿπÿ±ÿßÿ™ ŸÅŸä ÿßŸÑŸÖŸÜÿ≤ŸÑ",
            thumbnail: "/static/images/workout3.jpg",
            duration: "15:00"
        }
    ];
    
    const todayVideo = workoutVideos[new Date().getDay() % workoutVideos.length];
    displayDailyVideo(todayVideo);
}

function displayDailyVideo(video) {
    const videoContainer = document.querySelector('.daily-workout-video');
    if (videoContainer) {
        videoContainer.innerHTML = `
            <div class="card border-0 shadow-lg">
                <div class="position-relative">
                    <img src="${video.thumbnail}" class="card-img-top" alt="${video.title}" style="height: 200px; object-fit: cover;">
                    <div class="position-absolute top-50 start-50 translate-middle">
                        <button class="btn btn-primary btn-lg rounded-circle" onclick="playWorkoutVideo()">
                            <i class="fas fa-play"></i>
                        </button>
                    </div>
                    <span class="badge bg-dark position-absolute bottom-0 end-0 m-2">${video.duration}</span>
                </div>
                <div class="card-body">
                    <h5 class="card-title">${video.title}</h5>
                    <p class="card-text">${video.description}</p>
                    <button class="btn btn-primary" onclick="startWorkout()">
                        ÿßÿ®ÿØÿ£ ÿßŸÑÿ™ŸÖÿ±ŸäŸÜ <i class="fas fa-play ms-2"></i>
                    </button>
                </div>
            </div>
        `;
    }
}

function startWorkout() {
    updateUserProgress('workoutsCompleted');
    updateChallengeProgress('workout_streak');
    showNotification('üí™ ÿ±ÿßÿ¶ÿπ! ŸÑŸÇÿØ ÿ®ÿØÿ£ÿ™ ÿ™ŸÖÿ±ŸäŸÜ ÿßŸÑŸäŸàŸÖ', 'success');
}

// Utility Functions
function showNotification(message, type = 'info') {
    const notification = document.createElement('div');
    notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
    notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; max-width: 300px;';
    notification.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(notification);
    
    setTimeout(() => {
        notification.remove();
    }, 5000);
}

function checkAchievements() {
    const achievements = [
        { threshold: 5, message: 'üéâ ÿ£ŸàŸÑ 5 ÿ™ŸÖÿßÿ±ŸäŸÜ! ÿ£ŸÜÿ™ ŸÅŸä ÿßŸÑÿ∑ÿ±ŸäŸÇ ÿßŸÑÿµÿ≠Ÿäÿ≠' },
        { threshold: 10, message: 'üî• 10 ÿ™ŸÖÿßÿ±ŸäŸÜ ŸÖŸÉÿ™ŸÖŸÑÿ©! ÿßÿ≥ÿ™ŸÖÿ± ŸÅŸä ÿßŸÑÿ™ŸÇÿØŸÖ' },
        { threshold: 25, message: '‚≠ê 25 ÿ™ŸÖÿ±ŸäŸÜ! ÿ£ŸÜÿ™ ÿ®ÿ∑ŸÑ ÿ≠ŸÇŸäŸÇŸä' },
        { threshold: 50, message: 'üëë 50 ÿ™ŸÖÿ±ŸäŸÜ! ŸÑŸÇÿØ ÿ£ÿµÿ®ÿ≠ÿ™ ÿÆÿ®Ÿäÿ±ÿßŸã' }
    ];
    
    achievements.forEach(achievement => {
        if (userProgress.workoutsCompleted === achievement.threshold) {
            showNotification(achievement.message, 'success');
        }
    });
}

// Export functions for global use
window.engagementFunctions = {
    updateUserProgress,
    updateChallengeProgress,
    startWorkout,
    showNotification
};