<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>اختبار النظام - فحص شامل للتطبيق</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .tester-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        .test-card-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        .test-card-body {
            padding: 30px;
        }
        
        .test-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            font-weight: bold;
            margin: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }
        
        .test-button.danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        }
        
        .test-button.success {
            background: linear-gradient(135deg, #00b894 0%, #00a085 100%);
        }
        
        .test-button.warning {
            background: linear-gradient(135deg, #fdcb6e 0%, #e17055 100%);
        }
        
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .test-item {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-right: 4px solid #667eea;
        }
        
        .test-item h4 {
            color: #333;
            margin-bottom: 10px;
        }
        
        .test-item p {
            color: #666;
            margin-bottom: 15px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-left: 8px;
        }
        
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        .status-warning { background: #ffc107; }
        .status-info { background: #17a2b8; }
        
        .console-output {
            background: #1e1e1e;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
        }
        
        .hero-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 60px 0;
            text-align: center;
            margin-bottom: 40px;
        }
        
        .hero-section h1 {
            font-size: 3rem;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .hero-section p {
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .quick-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        @media (max-width: 768px) {
            .hero-section h1 {
                font-size: 2rem;
            }
            
            .quick-actions {
                flex-direction: column;
                align-items: center;
            }
            
            .test-button {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="hero-section">
        <div class="container">
            <h1>🧪 اختبار النظام</h1>
            <p>فحص شامل لجميع مكونات تطبيق اللياقة البدنية</p>
            <div class="quick-actions">
                <button class="test-button" onclick="runFullSystemTest()">
                    🚀 اختبار شامل للنظام
                </button>
                <button class="test-button success" onclick="runWorkoutPlanTest()">
                    💪 اختبار خطة التمرين
                </button>
                <button class="test-button warning" onclick="runPerformanceTest()">
                    ⚡ اختبار الأداء
                </button>
            </div>
        </div>
    </div>

    <div class="container tester-container">
        <!-- بطاقة الاختبارات السريعة -->
        <div class="test-card">
            <div class="test-card-header">
                <h2>⚡ الاختبارات السريعة</h2>
                <p>اختبارات أساسية للتحقق من سلامة النظام</p>
            </div>
            <div class="test-card-body">
                <div class="test-grid">
                    <div class="test-item">
                        <h4>🌐 اختبار الاتصال</h4>
                        <p>فحص الاتصال بالخادم وقاعدة البيانات</p>
                        <button class="test-button" onclick="testConnection()">تشغيل الاختبار</button>
                        <span id="connection-status" class="status-indicator status-info"></span>
                    </div>
                    
                    <div class="test-item">
                        <h4>📄 اختبار الصفحات</h4>
                        <p>التحقق من تحميل جميع الصفحات بشكل صحيح</p>
                        <button class="test-button" onclick="testPages()">تشغيل الاختبار</button>
                        <span id="pages-status" class="status-indicator status-info"></span>
                    </div>
                    
                    <div class="test-item">
                        <h4>🎨 اختبار التصميم</h4>
                        <p>فحص ملفات CSS والتصميم المتجاوب</p>
                        <button class="test-button" onclick="testDesign()">تشغيل الاختبار</button>
                        <span id="design-status" class="status-indicator status-info"></span>
                    </div>
                    
                    <div class="test-item">
                        <h4>⚙️ اختبار JavaScript</h4>
                        <p>فحص جميع ملفات JavaScript والوظائف</p>
                        <button class="test-button" onclick="testJavaScript()">تشغيل الاختبار</button>
                        <span id="js-status" class="status-indicator status-info"></span>
                    </div>
                    
                    <div class="test-item">
                        <h4>🔐 اختبار الأمان</h4>
                        <p>فحص الثغرات الأمنية والحماية</p>
                        <button class="test-button" onclick="testSecurity()">تشغيل الاختبار</button>
                        <span id="security-status" class="status-indicator status-info"></span>
                    </div>
                    
                    <div class="test-item">
                        <h4>📱 اختبار الجوال</h4>
                        <p>فحص التوافق مع الأجهزة المحمولة</p>
                        <button class="test-button" onclick="testMobile()">تشغيل الاختبار</button>
                        <span id="mobile-status" class="status-indicator status-info"></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- بطاقة الاختبارات المتقدمة -->
        <div class="test-card">
            <div class="test-card-header">
                <h2>🔬 الاختبارات المتقدمة</h2>
                <p>اختبارات تفصيلية لمكونات النظام</p>
            </div>
            <div class="test-card-body">
                <div class="row">
                    <div class="col-md-6">
                        <h4>🏋️ اختبار خطة التمرين</h4>
                        <p>فحص شامل لنظام إنشاء خطط التمرين</p>
                        <button class="test-button success" onclick="runWorkoutPlanTest()">
                            تشغيل الاختبار
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h4>🍎 اختبار خطة الوجبات</h4>
                        <p>فحص نظام إنشاء خطط الوجبات</p>
                        <button class="test-button success" onclick="runMealPlanTest()">
                            تشغيل الاختبار
                        </button>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-6">
                        <h4>🧮 اختبار الحاسبات</h4>
                        <p>فحص حاسبات BMI والسعرات الحرارية</p>
                        <button class="test-button warning" onclick="runCalculatorsTest()">
                            تشغيل الاختبار
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h4>📊 اختبار قاعدة البيانات</h4>
                        <p>فحص اتصال وعمليات قاعدة البيانات</p>
                        <button class="test-button warning" onclick="runDatabaseTest()">
                            تشغيل الاختبار
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- بطاقة أدوات الإصلاح -->
        <div class="test-card">
            <div class="test-card-header">
                <h2>🔧 أدوات الإصلاح</h2>
                <p>أدوات لإصلاح المشاكل الشائعة تلقائياً</p>
            </div>
            <div class="test-card-body">
                <div class="row">
                    <div class="col-md-4">
                        <button class="test-button danger" onclick="clearCache()">
                            🗑️ مسح الذاكرة المؤقتة
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="test-button danger" onclick="resetDatabase()">
                            🔄 إعادة تعيين قاعدة البيانات
                        </button>
                    </div>
                    <div class="col-md-4">
                        <button class="test-button danger" onclick="restartServer()">
                            🔄 إعادة تشغيل الخادم
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- وحدة التحكم -->
        <div class="test-card">
            <div class="test-card-header">
                <h2>💻 وحدة التحكم</h2>
                <p>مراقبة مباشرة لنتائج الاختبارات</p>
            </div>
            <div class="test-card-body">
                <div class="console-output" id="console-output">
                    <div>🚀 مرحباً بك في نظام اختبار التطبيق</div>
                    <div>📅 الوقت: <span id="current-time"></span></div>
                    <div>🌐 الحالة: جاهز للاختبار</div>
                    <div>-----------------------------------</div>
                </div>
                <div class="mt-3">
                    <button class="test-button" onclick="clearConsole()">مسح وحدة التحكم</button>
                    <button class="test-button success" onclick="exportResults()">تصدير النتائج</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="{{ url_for('static', filename='js/workout-plan-tester.js') }}"></script>
    <script>
        // تحديث الوقت
        function updateTime() {
            document.getElementById('current-time').textContent = new Date().toLocaleString('ar-SA');
        }
        setInterval(updateTime, 1000);
        updateTime();

        // إضافة رسالة إلى وحدة التحكم
        function addToConsole(message, type = 'info') {
            const console = document.getElementById('console-output');
            const timestamp = new Date().toLocaleTimeString('ar-SA');
            const icons = {
                info: 'ℹ️',
                success: '✅',
                error: '❌',
                warning: '⚠️'
            };
            
            const div = document.createElement('div');
            div.innerHTML = `[${timestamp}] ${icons[type]} ${message}`;
            console.appendChild(div);
            console.scrollTop = console.scrollHeight;
        }

        // مسح وحدة التحكم
        function clearConsole() {
            const console = document.getElementById('console-output');
            console.innerHTML = `
                <div>🚀 تم مسح وحدة التحكم</div>
                <div>📅 الوقت: ${new Date().toLocaleString('ar-SA')}</div>
                <div>-----------------------------------</div>
            `;
        }

        // اختبار الاتصال
        async function testConnection() {
            addToConsole('بدء اختبار الاتصال...', 'info');
            const status = document.getElementById('connection-status');
            
            try {
                const response = await fetch('/');
                if (response.ok) {
                    status.className = 'status-indicator status-success';
                    addToConsole('✅ الاتصال بالخادم ناجح', 'success');
                } else {
                    status.className = 'status-indicator status-error';
                    addToConsole('❌ فشل الاتصال بالخادم', 'error');
                }
            } catch (error) {
                status.className = 'status-indicator status-error';
                addToConsole(`❌ خطأ في الاتصال: ${error.message}`, 'error');
            }
        }

        // اختبار الصفحات
        async function testPages() {
            addToConsole('بدء اختبار الصفحات...', 'info');
            const status = document.getElementById('pages-status');
            
            const pages = [
                '/',
                '/workout-plan-input',
                '/calculators',
                '/meal-generator',
                '/tips'
            ];
            
            let successCount = 0;
            
            for (const page of pages) {
                try {
                    const response = await fetch(page);
                    if (response.ok) {
                        successCount++;
                        addToConsole(`✅ الصفحة ${page} تعمل بشكل صحيح`, 'success');
                    } else {
                        addToConsole(`❌ مشكلة في الصفحة ${page}`, 'error');
                    }
                } catch (error) {
                    addToConsole(`❌ خطأ في تحميل ${page}: ${error.message}`, 'error');
                }
            }
            
            if (successCount === pages.length) {
                status.className = 'status-indicator status-success';
                addToConsole('✅ جميع الصفحات تعمل بشكل صحيح', 'success');
            } else {
                status.className = 'status-indicator status-warning';
                addToConsole(`⚠️ ${successCount}/${pages.length} صفحة تعمل بشكل صحيح`, 'warning');
            }
        }

        // اختبار التصميم
        function testDesign() {
            addToConsole('بدء اختبار التصميم...', 'info');
            const status = document.getElementById('design-status');
            
            const cssFiles = document.querySelectorAll('link[rel="stylesheet"]');
            if (cssFiles.length > 0) {
                status.className = 'status-indicator status-success';
                addToConsole(`✅ تم العثور على ${cssFiles.length} ملف CSS`, 'success');
            } else {
                status.className = 'status-indicator status-error';
                addToConsole('❌ لم يتم العثور على ملفات CSS', 'error');
            }
            
            // اختبار التصميم المتجاوب
            const viewport = document.querySelector('meta[name="viewport"]');
            if (viewport) {
                addToConsole('✅ إعدادات التصميم المتجاوب موجودة', 'success');
            } else {
                addToConsole('⚠️ إعدادات التصميم المتجاوب مفقودة', 'warning');
            }
        }

        // اختبار JavaScript
        function testJavaScript() {
            addToConsole('بدء اختبار JavaScript...', 'info');
            const status = document.getElementById('js-status');
            
            const jsFiles = document.querySelectorAll('script[src]');
            if (jsFiles.length > 0) {
                status.className = 'status-indicator status-success';
                addToConsole(`✅ تم العثور على ${jsFiles.length} ملف JavaScript`, 'success');
            } else {
                status.className = 'status-indicator status-warning';
                addToConsole('⚠️ لم يتم العثور على ملفات JavaScript خارجية', 'warning');
            }
            
            // اختبار الوظائف الأساسية
            if (typeof workoutTester !== 'undefined') {
                addToConsole('✅ مختبر خطة التمرين متاح', 'success');
            } else {
                addToConsole('❌ مختبر خطة التمرين غير متاح', 'error');
            }
        }

        // اختبار الأمان
        function testSecurity() {
            addToConsole('بدء اختبار الأمان...', 'info');
            const status = document.getElementById('security-status');
            
            // فحص HTTPS
            if (location.protocol === 'https:') {
                addToConsole('✅ الموقع يستخدم HTTPS', 'success');
            } else {
                addToConsole('⚠️ الموقع لا يستخدم HTTPS', 'warning');
            }
            
            // فحص CSP
            const csp = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (csp) {
                addToConsole('✅ سياسة أمان المحتوى موجودة', 'success');
            } else {
                addToConsole('⚠️ سياسة أمان المحتوى مفقودة', 'warning');
            }
            
            status.className = 'status-indicator status-success';
            addToConsole('✅ اكتمل فحص الأمان الأساسي', 'success');
        }

        // اختبار الجوال
        function testMobile() {
            addToConsole('بدء اختبار التوافق مع الجوال...', 'info');
            const status = document.getElementById('mobile-status');
            
            const isMobile = window.innerWidth <= 768;
            const hasViewport = document.querySelector('meta[name="viewport"]');
            const hasBootstrap = document.querySelector('link[href*="bootstrap"]');
            
            if (hasViewport && hasBootstrap) {
                status.className = 'status-indicator status-success';
                addToConsole('✅ الموقع متوافق مع الأجهزة المحمولة', 'success');
            } else {
                status.className = 'status-indicator status-warning';
                addToConsole('⚠️ قد تكون هناك مشاكل في التوافق مع الجوال', 'warning');
            }
            
            addToConsole(`📱 عرض الشاشة الحالي: ${window.innerWidth}px`, 'info');
        }

        // تشغيل اختبار شامل للنظام
        async function runFullSystemTest() {
            addToConsole('🚀 بدء الاختبار الشامل للنظام...', 'info');
            
            await testConnection();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            await testPages();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testDesign();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testJavaScript();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testSecurity();
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            testMobile();
            
            addToConsole('🎉 اكتمل الاختبار الشامل للنظام!', 'success');
        }

        // تشغيل اختبار خطة التمرين
        function runWorkoutPlanTest() {
            addToConsole('💪 بدء اختبار خطة التمرين...', 'info');
            if (typeof workoutTester !== 'undefined') {
                workoutTester.startComprehensiveTest();
            } else {
                addToConsole('❌ مختبر خطة التمرين غير متاح', 'error');
            }
        }

        // اختبارات أخرى (مبسطة)
        function runMealPlanTest() {
            addToConsole('🍎 اختبار خطة الوجبات قيد التطوير...', 'info');
        }

        function runCalculatorsTest() {
            addToConsole('🧮 اختبار الحاسبات قيد التطوير...', 'info');
        }

        function runDatabaseTest() {
            addToConsole('📊 اختبار قاعدة البيانات قيد التطوير...', 'info');
        }

        function runPerformanceTest() {
            addToConsole('⚡ اختبار الأداء قيد التطوير...', 'info');
        }

        // أدوات الإصلاح
        function clearCache() {
            addToConsole('🗑️ مسح الذاكرة المؤقتة...', 'info');
            if ('caches' in window) {
                caches.keys().then(names => {
                    names.forEach(name => {
                        caches.delete(name);
                    });
                });
            }
            localStorage.clear();
            sessionStorage.clear();
            addToConsole('✅ تم مسح الذاكرة المؤقتة', 'success');
        }

        function resetDatabase() {
            addToConsole('🔄 إعادة تعيين قاعدة البيانات قيد التطوير...', 'warning');
        }

        function restartServer() {
            addToConsole('🔄 إعادة تشغيل الخادم قيد التطوير...', 'warning');
        }

        // تصدير النتائج
        function exportResults() {
            const consoleContent = document.getElementById('console-output').innerText;
            const blob = new Blob([consoleContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `system-test-results-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);
            addToConsole('📄 تم تصدير النتائج', 'success');
        }
    </script>
</body>
</html>